<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
<title>5DO Pro</title>

<!-- Supabase -->
<link rel="preconnect" href="https://xdjgumqdwedgzwqturcx.supabase.co">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>

<style>
:root{
  --bg:#0b0d13; --panel:#12141b; --card:#181b25; --ink:#e5e7eb;
  --muted:#9aa3b7; --border:#222738; --chip:#0e1016; --accent:#9cff8b;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,'Noto Sans KR',Roboto,Arial}

/* ===== Header + Tabs + Lang ===== */
header{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:10px 14px;background:var(--panel);border-bottom:1px solid var(--border);position:relative;
}
.logo{font-weight:700;color:var(--accent);font-size:1.2rem;margin-left:40px;} 
.tabs{display:flex;gap:6px}
.tab{
  padding:4px 6px;font-size:.72rem;border:1px solid var(--border);
  border-radius:8px;background:#171d2b;color:#cfead1;cursor:pointer
}
.tab.active{background:#1f2739;border-color:#334}
.section{display:none}
.section.active{display:block}
.lang-toggle{
  color:#fff;border:1px solid #444;padding:4px 8px;border-radius:6px;
  cursor:pointer;font-size:.8rem;user-select:none;background:#171d2b;
}
.lang-toggle:hover{background:#1f2739}

/* ===== Hamburger ===== */
.menu-container{position:absolute;top:12px;left:10px;z-index:2000}
.menu-button{font-size:24px;cursor:pointer;user-select:none;color:#fff}
.dropdown-menu{
  display:none;flex-direction:column;position:absolute;background:rgba(0,0,0,0.9);
  padding:8px 10px;border-radius:10px;margin-top:7px;z-index:2001;width:160px
}
.dropdown-menu a{color:#fff;padding:6px 10px;text-decoration:none;border-radius:6px}
.dropdown-menu a:hover{background:rgba(255,255,255,0.1)}
.menu-backdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.3);z-index:2000}

/* ===== Library ===== */
#osc{width:100%;height:120px;background:#090b11;display:block;border-bottom:1px solid var(--border)}
#navBtns{display:flex;justify-content:center;gap:8px;padding:8px}
.btn{background:#1e2232;border:1px solid #2c3147;color:#eee;border-radius:10px;
  padding:8px 10px;cursor:pointer;transition:background .2s;font-size:1.3rem;line-height:1}
.btn:hover{background:#2a3148;}
.lib-wrap{padding:0 10px 10px}
#library{display:flex;overflow-x:auto;gap:10px;padding:10px;scroll-behavior:smooth;scroll-snap-type:x mandatory}
.card{flex:0 0 auto;width:160px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:6px;scroll-snap-align:start}
.card img{width:100%;aspect-ratio:1/1;object-fit:contain;background:var(--chip);border-radius:8px}

/* ===== Controls ===== */
.controls{display:flex;flex-direction:column;align-items:flex-start;gap:10px;padding:12px;
  background:#0f1320;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
.status{display:flex;align-items:center;gap:18px;margin-bottom:2px}
#statusThumb{width:124px;height:124px;border-radius:16px;position:relative;overflow:hidden;
  background:radial-gradient(circle at center,#1a1f2f 40%,#0d0f18 100%);
  border:1px solid #2d334a;box-shadow:0 0 12px rgba(80,180,255,0.15);
  background-size:cover;background-position:center;}
#statusThumb::before{content:'';position:absolute;inset:0;border-radius:50%;
  background:radial-gradient(circle,rgba(100,200,255,0.25),transparent 60%);
  animation:pulse 2s infinite ease-in-out;}
#statusThumb.loaded::before{display:none;}
@keyframes pulse{0%,100%{transform:scale(0.8);opacity:0.5;}50%{transform:scale(1.1);opacity:1;}}
.ctrl-stack{display:flex;flex-direction:column;gap:10px}
.ctrl-line{display:flex;align-items:center;gap:8px}
#vol{width:140px}
audio{width:92%;display:block;margin:10px auto}

/* ===== Generator ===== */
.gen-wrap{padding:12px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.field{background:#141a27;border:1px solid #2a3044;border-radius:12px;padding:10px}
.field h4{margin:0 0 8px 0;color:#dfe7f6;font-size:.95rem}
.field label{display:block;font-size:.85rem;color:#9aa3b7;margin-bottom:4px}
.field input[type="number"],.field select,.field input[type="range"]{
  width:100%;background:#101522;color:#e9eefc;border:1px solid #2a3044;border-radius:8px;padding:6px}
.row{display:flex;gap:8px;align-items:center}
.switch{display:flex;gap:8px;align-items:center}
.full{grid-column:1/-1}
.gen-actions{display:flex;gap:10px}
.pill{padding:8px 12px;border-radius:100px;border:1px solid #2c3147;background:#1b2333;color:#e9eefc;cursor:pointer}
.pill.primary{background:#21324e;border-color:#355;color:#cfead1}
.note{color:#8aa0bd;font-size:.88rem;margin-top:4px}
@media (max-width:540px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>

<!-- ÌñÑÎ≤ÑÍ±∞ -->
<div class="menu-container">
  <div class="menu-button" id="menuButton">‚ò∞</div>
  <div class="dropdown-menu" id="dropdownMenu">
    <a href="https://5dshop.co.kr" target="_blank">Shop</a>
    <a href="#">FAQ</a><a href="#">Manual</a><a href="#">Contact</a><a href="#">About</a>
  </div>
  <div class="menu-backdrop" id="menuBackdrop"></div>
</div>

<header>
  <div class="logo">5DO Pro</div>
  <div class="tabs"><div class="tab active" data-tab="lib">5DO</div><div class="tab" data-tab="gen">Freq. Gen.</div></div>
  <div id="langToggle" class="lang-toggle">EN</div>
</header>

<canvas id="osc"></canvas>

<section id="section-lib" class="section active">
  <div id="navBtns">
    <button id="btnBack" class="btn" title="Back">‚¨ÖÔ∏è</button>
    <button id="btnRefresh" class="btn" title="Refresh">üîÑ</button>
  </div>
  <div class="lib-wrap"><div id="library"></div></div>
  <div class="controls">
    <div class="status">
      <div id="statusThumb"></div>
      <div class="ctrl-stack">
        <div class="ctrl-line"><label for="vol">Volume</label><input id="vol" type="range" min="0" max="1" step="0.01" value="1"></div>
        <div class="ctrl-line"><label><input type="checkbox" id="loop"> Loop</label></div>
        <div class="ctrl-line"><label for="timer">Timer</label>
          <select id="timer"><option value="0">Off</option><option value="5">5 min</option><option value="10">10 min</option></select>
        </div>
      </div>
    </div>
    <audio id="player" controls preload="none" playsinline></audio>
  </div>
</section>

<section id="section-gen" class="section">
  <div class="gen-wrap">
    <div class="grid">
      <div class="field"><h4>Waveform</h4><select id="genWave"><option value="sine">Sine</option><option value="square">Square</option><option value="sawtooth">Saw</option><option value="triangle">Triangle</option></select></div>
      <div class="field"><h4>Level</h4><input id="genLevel" type="range" min="0" max="1" step="0.01" value="0.5"></div>
      <div class="field"><h4>Frequency (Hz)</h4><input id="genFreq" type="number" min="1" max="24000" step="0.1" value="440"></div>
      <div class="field"><h4>Binaural Beat</h4><label class="switch"><input type="checkbox" id="genBinaural"> Enable</label><label for="genBeat">Difference (Hz)</label><input id="genBeat" type="number" min="0" max="1000" step="0.1" value="7"></div>
      <div class="field full"><h4>Session</h4><div class="gen-actions">
        <button id="genStart" class="pill primary">‚ñ∂Ô∏è</button>
        <button id="genStop" class="pill">‚èπÔ∏è</button>
      </div><div class="note">Generator ÏãúÏûë Ïãú LibraryÎäî ÏûêÎèô ÏùºÏãúÏ†ïÏßÄÎê©ÎãàÎã§.</div></div>
    </div>
  </div>
</section>

<script>
/* ÌñÑÎ≤ÑÍ±∞ */
const menuBtn=document.getElementById("menuButton");
const menu=document.getElementById("dropdownMenu");
const backdrop=document.getElementById("menuBackdrop");
menuBtn.onclick=()=>{const o=menu.style.display==="flex";menu.style.display=o?"none":"flex";backdrop.style.display=o?"none":"block";};
backdrop.onclick=()=>{menu.style.display="none";backdrop.style.display="none";};

/* ÌÉ≠ */
const tabs=document.querySelectorAll(".tab"),libS=document.getElementById("section-lib"),genS=document.getElementById("section-gen");
tabs.forEach(t=>t.onclick=()=>{tabs.forEach(x=>x.classList.remove("active"));t.classList.add("active");
  if(t.dataset.tab==="lib"){libS.classList.add("active");genS.classList.remove("active");stopGenerator?.();}
  else{genS.classList.add("active");libS.classList.remove("active");player.pause();}});

/* Í∏∞Î≥∏ AudioContext */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
const masterGain=audioCtx.createGain(); masterGain.connect(audioCtx.destination);
const player=document.getElementById("player");
const mediaSrc=audioCtx.createMediaElementSource(player);
const analyser=audioCtx.createAnalyser(); mediaSrc.connect(masterGain); masterGain.connect(analyser);

/* Generator */
const genGain=audioCtx.createGain(); genGain.connect(masterGain);
let genState={running:false,nodes:[]};
function ensureAudioUnlocked(){if(audioCtx.state!=="running")audioCtx.resume();}
document.addEventListener("pointerdown",ensureAudioUnlocked,{once:true});

function stopGenerator(){
  if(!genState.running)return;
  genState.nodes.forEach(n=>{try{n.stop();n.disconnect();}catch{}});
  genState={running:false,nodes:[]};
  genGain.gain.setTargetAtTime(0,audioCtx.currentTime,0.02);
}

function startGenerator(){
  ensureAudioUnlocked(); if(!player.paused)player.pause(); if(genState.running)stopGenerator();
  const w=document.getElementById("genWave").value,f=parseFloat(document.getElementById("genFreq").value||440),
        bb=document.getElementById("genBinaural").checked,bh=parseFloat(document.getElementById("genBeat").value||7),
        lvl=parseFloat(document.getElementById("genLevel").value||0.5);
  genGain.gain.value=lvl;
  if(bb){
    const l=audioCtx.createOscillator(),r=audioCtx.createOscillator();
    l.type=w;r.type=w;l.frequency.value=f;r.frequency.value=f+bh;
    try{const pl=audioCtx.createStereoPanner(),pr=audioCtx.createStereoPanner();pl.pan.value=-1;pr.pan.value=1;
      l.connect(pl).connect(genGain);r.connect(pr).connect(genGain);genState.nodes=[l,r,pl,pr];
    }catch{l.connect(genGain);r.connect(genGain);genState.nodes=[l,r];}
    l.start();r.start();
  }else{const o=audioCtx.createOscillator();o.type=w;o.frequency.value=f;o.connect(genGain);o.start();genState.nodes=[o];}
  genState.running=true;
}
document.getElementById("genStart").onclick=startGenerator;
document.getElementById("genStop").onclick=stopGenerator;
</script>
</body>
</html>
