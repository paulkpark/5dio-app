<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>5DO meta.json Editor</title>
  <style>
    body{
      margin:0; padding:16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:#050915; color:#e8f4ff;
    }
    h1{font-size:20px; margin:0 0 12px;}
    h2{font-size:16px; margin:16px 0 8px;}
    .layout{
      display:flex; gap:16px; align-items:flex-start;
      flex-wrap:wrap;
    }
    .col{
      flex:1 1 360px;
      min-width:320px;
      background:#0b1220;
      border-radius:12px;
      padding:12px 14px;
      box-shadow:0 0 0 1px #111b2f;
    }
    label{
      display:block;
      font-size:13px;
      margin:8px 0 4px;
      color:#b7d3ff;
    }
    input, textarea, select{
      width:100%;
      box-sizing:border-box;
      background:#050a14;
      border:1px solid #243659;
      border-radius:8px;
      padding:6px 8px;
      color:#e8f4ff;
      font-size:13px;
    }
    textarea{
      min-height:80px;
      resize:vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,"Liberation Mono","Courier New", monospace;
    }
    .row{display:flex; gap:8px;}
    .row > div{flex:1;}
    button{
      background:#1f6ff0;
      border:none;
      border-radius:999px;
      padding:6px 14px;
      color:white;
      font-size:13px;
      cursor:pointer;
      margin-top:10px;
    }
    button.secondary{
      background:#141b2b;
      border:1px solid #32425f;
    }
    button:disabled{opacity:.4; cursor:default;}
    .small{font-size:11px; color:#90a4c9;}
    .badge{
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      background:#141f36;
      font-size:11px;
      margin-left:4px;
      color:#a4c7ff;
    }
    .error{
      color:#ff6d6d;
      font-size:12px;
      margin-top:4px;
      min-height:16px;
    }
    pre{
      white-space:pre-wrap;
      word-break:break-all;
      font-size:12px;
      margin:0;
    }
  </style>
</head>
<body>
  <h1>5DO meta.json Editor <span class="badge">local tool</span></h1>
  <p class="small">
    1) 현재 <code>meta.json</code> 내용을 왼쪽 상단에 붙여넣고 “JSON 불러오기”를 누른 뒤<br/>
    2) 아래 폼에 Path / 파일명 / 한·영 설명을 입력하고 “추가 / 업데이트”를 누르면 됩니다.
  </p>

  <div class="layout">
    <!-- 원본 / 결과 JSON 영역 -->
    <div class="col">
      <h2>기존 meta.json (옵션)</h2>
      <label for="jsonInput">현재 meta.json 내용을 붙여넣으세요 (없으면 비워둬도 됩니다)</label>
      <textarea id="jsonInput" spellcheck="false">{}</textarea>
      <button id="btnLoad" class="secondary">JSON 불러오기</button>
      <div id="loadError" class="error"></div>

      <h2 style="margin-top:16px;">결과 meta.json</h2>
      <button id="btnDownload">meta.json 다운로드</button>
      <p class="small">아래 내용이 실제로 저장될 JSON입니다.</p>
      <pre id="jsonPreview">{}</pre>
    </div>

    <!-- 입력 폼 -->
    <div class="col">
      <h2>트랙 메타데이터 입력</h2>
      <div class="row">
        <div>
          <label for="pathInput">Path / 폴더명 (예: <code>Quantum_Torus_X</code>)</label>
          <input id="pathInput" placeholder="예: Quantum_Torus_X" />
        </div>
        <div>
          <label for="baseInput">파일 베이스명 (확장자 제외, 예: <code>Brain_Heart_Cohesion</code>)</label>
          <input id="baseInput" placeholder="예: Brain_Heart_Cohesion" />
        </div>
      </div>

      <label for="titleKo">제목 (한국어)</label>
      <input id="titleKo" placeholder="예: 브레인 · 하트 코히어런스" />

      <label for="titleEn">Title (English)</label>
      <input id="titleEn" placeholder="예: Brain &amp; Heart Coherence" />

      <label for="descKo">설명 (한국어)</label>
      <textarea id="descKo" placeholder="이 트랙의 특징, 효과, 사용 TIP 등을 한국어로 적어주세요."></textarea>

      <label for="descEn">Description (English)</label>
      <textarea id="descEn" placeholder="Describe features, effects, and usage tips in English."></textarea>

      <div class="row">
        <div>
          <label for="tagsInput">태그 (콤마로 구분)</label>
          <input id="tagsInput" placeholder="예: 감마파, 집중력, 하트코히어런스" />
        </div>
        <div>
          <label for="durationInput">길이 (선택, 예: 20:00)</label>
          <input id="durationInput" placeholder="예: 20:00" />
        </div>
      </div>

      <label for="effectsKo">효과 요약 (한국어, 옵션)</label>
      <textarea id="effectsKo" placeholder="예: 집중력 향상, 감정 안정, 깊은 명상 유도"></textarea>

      <label for="effectsEn">Effects (English, optional)</label>
      <textarea id="effectsEn" placeholder="ex: improved focus, emotional balance, deep meditation"></textarea>

      <button id="btnAdd">추가 / 업데이트</button>
      <div id="formError" class="error"></div>
      <p class="small">
        · 실제 meta 키는 <code>Path/Base</code> 형식으로 저장됩니다. (예: <code>Quantum_Torus_X/Brain_Heart_Cohesion</code>)<br/>
        · 같은 키를 다시 저장하면 해당 트랙의 메타데이터를 업데이트합니다.
      </p>
    </div>
  </div>

  <script>
    // 내부 메모리 객체 (실제 meta.json)
    let META = {};

    const $ = id => document.getElementById(id);
    const jsonInput   = $('jsonInput');
    const jsonPreview = $('jsonPreview');
    const loadError   = $('loadError');
    const formError   = $('formError');

    function refreshPreview(){
      jsonPreview.textContent = JSON.stringify(META, null, 2);
    }

    // 1) 기존 meta.json 불러오기
    $('btnLoad').addEventListener('click', () => {
      loadError.textContent = '';
      try{
        const obj = JSON.parse(jsonInput.value.trim() || '{}');
        if(typeof obj !== 'object' || Array.isArray(obj)){
          throw new Error('meta.json 루트는 객체여야 합니다.');
        }
        META = obj;
        refreshPreview();
      }catch(err){
        console.error(err);
        loadError.textContent = 'JSON 파싱 오류: ' + err.message;
      }
    });

    // 2) 폼 -> META 업데이트
    $('btnAdd').addEventListener('click', () => {
      formError.textContent = '';

      const path  = $('pathInput').value.trim();
      const base  = $('baseInput').value.trim();
      const tKo   = $('titleKo').value.trim();
      const tEn   = $('titleEn').value.trim();
      const dKo   = $('descKo').value.trim();
      const dEn   = $('descEn').value.trim();
      const tags  = $('tagsInput').value.trim();
      const dur   = $('durationInput').value.trim();
      const effKo = $('effectsKo').value.trim();
      const effEn = $('effectsEn').value.trim();

      if(!path || !base){
        formError.textContent = 'Path와 파일 베이스명은 필수입니다.';
        return;
      }

      const key = `${path}/${base}`;

      const entry = {
        title_ko: tKo || undefined,
        title_en: tEn || undefined,
        desc_ko : dKo || undefined,
        desc_en : dEn || undefined
      };

      if(tags){
        entry.tags = tags.split(',').map(s => s.trim()).filter(Boolean);
      }
      if(dur){
        entry.duration = dur;
      }
      if(effKo){
        entry.effects_ko = effKo.split('\n').map(s => s.trim()).filter(Boolean);
      }
      if(effEn){
        entry.effects_en = effEn.split('\n').map(s => s.trim()).filter(Boolean);
      }

      // undefined 필드는 제거
      Object.keys(entry).forEach(k => entry[k] === undefined && delete entry[k]);

      META[key] = entry;
      refreshPreview();
    });

    // 3) meta.json 다운로드
    $('btnDownload').addEventListener('click', () => {
      const blob = new Blob(
        [JSON.stringify(META, null, 2)],
        { type: 'application/json' }
      );
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'meta.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // 초기 프리뷰
    refreshPreview();
  </script>
</body>
</html>